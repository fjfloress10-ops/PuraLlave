<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Publicar Inmueble - PuraLlave</title>

<style>
:root{
--primario:#0984e3;
--secundario:#00b894;
--fondo:#f1f7f9;
--blanco:#fff;
--texto:#2d3436;
--borde:#dfe6e9;
}

body.dark-mode{
--fondo:#0f172a;
--blanco:#1e293b;
--texto:#f1f2f6;
--primario:#3498db;
--secundario:#55efc4;
--borde:#334155;
}

body{
font-family:Segoe UI,sans-serif;
background:var(--fondo);
margin:0;
padding:20px;
color:var(--texto);
transition:.3s;
}

.form-container{
max-width:700px;
margin:auto;
background:var(--blanco);
padding:30px;
border-radius:15px;
box-shadow:0 5px 20px rgba(0,0,0,.1);
}

.grid-form{
display:grid;
grid-template-columns:1fr 1fr;
gap:20px;
margin-top:20px;
}

.full-width{grid-column:span 2}

label{font-weight:600}

input,select,textarea{
width:100%;
padding:12px;
border:1px solid var(--borde);
border-radius:8px;
background:var(--fondo);
color:var(--texto);
}

.upload-box{
border:2px dashed var(--borde);
padding:20px;
border-radius:10px;
text-align:center;
background:var(--fondo);
}

.btn-fotos{
background:var(--secundario);
border:none;
padding:10px 20px;
color:white;
border-radius:5px;
cursor:pointer;
}

.galeria-preview{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(100px,1fr));
gap:10px;
margin-top:20px;
}

.foto-item{
position:relative;
padding-top:100%;
border-radius:8px;
overflow:hidden;
border:1px solid var(--borde);
}

.foto-item img,video{
position:absolute;
top:0;left:0;width:100%;height:100%;object-fit:cover;
}

.btn-borrar-foto{
position:absolute;
top:2px;
right:2px;
background:red;
border:none;
border-radius:50%;
width:22px;
height:22px;
color:white;
cursor:pointer;
}

.btn-finalizar{
margin-top:30px;
width:100%;
padding:15px;
border:none;
border-radius:8px;
background:var(--primario);
color:white;
font-size:1.1rem;
font-weight:bold;
cursor:pointer;
}

.btn-dark-mode{
position:fixed;
bottom:20px;
right:20px;
padding:12px 20px;
border-radius:50px;
border:none;
cursor:pointer;
background:var(--primario);
color:white;
font-weight:bold;
}
</style>
</head>

<body>

<button id="btnDark" class="btn-dark-mode" onclick="toggleDarkMode()">üåô Modo Oscuro</button>

<div class="form-container">

<h2>Detalles del Inmueble</h2>

<form id="formInmueble">

<div class="grid-form">

<div class="full-width">
<label>Tipo inmueble</label>
<select id="tipoInmueble" onchange="ajustarFormulario()">
<option value="piso">Piso / Casa</option>
<option value="habitacion">Habitaci√≥n</option>
<option value="garaje">Garaje</option>
<option value="trastero">Trastero</option>
<option value="local">Local</option>
<option value="oficina">Oficina</option>
<option value="terreno">Terreno</option>
</select>
</div>

<div class="full-width">
<label>Tipo anuncio</label>
<select id="tipoAnuncio" onchange="actualizarEtiquetaPrecio()">
<option value="vender">Vender</option>
<option value="alquilar">Alquilar</option>
</select>
</div>

<div class="full-width">
<label>T√≠tulo del anuncio</label>
<input type="text" id="titulo" placeholder="Ej: √Åtico luminoso cerca del metro" required>
</div>

<div class="full-width">
<label>Localidad</label>
<select id="localidad" required>
<option value="">Selecciona una ciudad</option>
<optgroup label="Andaluc√≠a">
<option value="Almer√≠a">Almer√≠a</option>
<option value="C√°diz">C√°diz</option>
<option value="C√≥rdoba">C√≥rdoba</option>
<option value="Granada">Granada</option>
<option value="Huelva">Huelva</option>
<option value="Ja√©n">Ja√©n</option>
<option value="M√°laga">M√°laga</option>
<option value="Sevilla">Sevilla</option>
</optgroup>
<optgroup label="Madrid">
<option value="Madrid">Madrid</option>
<option value="M√≥stoles">M√≥stoles</option>
</optgroup>
<optgroup label="Catalu√±a">
<option value="Barcelona">Barcelona</option>
<option value="Tarragona">Tarragona</option>
</optgroup>
<optgroup label="Valencia">
<option value="Valencia">Valencia</option>
<option value="Alicante">Alicante</option>
</optgroup>
</select>
</div>

<div>
<label id="labelPrecio">Precio (‚Ç¨)</label>
<input type="number" id="precio" placeholder="Ej: 150000" required>
</div>

<div>
<label>Dimensiones (m¬≤)</label>
<input type="number" id="dimensiones" placeholder="Ej: 85" required>
</div>

<div class="opcional-vivienda">
<select id="habitaciones">
<option>Estudio</option>
<option>1</option>
<option>2</option>
<option>3</option>
<option>4+</option>
</select>
</div>

<div class="opcional-vivienda">
<select id="banos">
<option>1 ba√±o</option>
<option>2 ba√±os</option>
<option>3+</option>
</select>
</div>

<div class="full-width">
<label>Fotos</label>
<div class="upload-box">
<button type="button" class="btn-fotos" onclick="inputFotos.click()">Seleccionar fotos</button>
<input id="inputFotos" type="file" multiple hidden accept="image/*" onchange="manejarFotos(event)">
<p id="infoFotos">0 / 35</p>
</div>
<div id="galeria" class="galeria-preview"></div>
</div>

<div class="full-width">
<label>Videos</label>
<div class="upload-box">
<button type="button" class="btn-fotos" onclick="inputVideos.click()">Seleccionar videos</button>
<input id="inputVideos" type="file" multiple hidden accept="video/*" onchange="manejarVideos(event)">
<p id="infoVideos">0 / 2</p>
</div>
<div id="galeriaVideos" class="galeria-preview"></div>
</div>

<div class="full-width">
<textarea id="descripcion" placeholder="Descripci√≥n"></textarea>
</div>

</div>

<button class="btn-finalizar">Publicar anuncio</button>

</form>
</div>

<script>

let archivosFotos=[];
let archivosVideos=[];

function toggleDarkMode(){
document.body.classList.toggle("dark-mode");
const d=document.body.classList.contains("dark-mode");
localStorage.setItem("darkMode",d);
btnDark.textContent=d?"‚òÄÔ∏è Modo Claro":"üåô Modo Oscuro";
}

document.addEventListener("DOMContentLoaded",()=>{
if(localStorage.getItem("darkMode")==="true"){
document.body.classList.add("dark-mode");
btnDark.textContent="‚òÄÔ∏è Modo Claro";
}
actualizarEtiquetaPrecio();
ajustarFormulario();
});

function actualizarEtiquetaPrecio(){
labelPrecio.innerText=
tipoAnuncio.value==="alquilar"?"Precio mensual (‚Ç¨)":"Precio (‚Ç¨)";
}

function ajustarFormulario(){
document.querySelectorAll(".opcional-vivienda")
.forEach(e=>e.style.display=tipoInmueble.value==="piso"?"block":"none");
}

function manejarFotos(e){
archivosFotos=[...archivosFotos,...e.target.files].slice(0,35);
infoFotos.innerText=archivosFotos.length+" / 35";
galeria.innerHTML="";
archivosFotos.forEach((f,i)=>{
let d=document.createElement("div");
d.className="foto-item";
d.innerHTML=`<img src="${URL.createObjectURL(f)}"><button class="btn-borrar-foto" onclick="borrarFoto(${i})">X</button>`;
galeria.appendChild(d);
});
}

function borrarFoto(i){
archivosFotos.splice(i,1);
manejarFotos({target:{files:[]}})
}

function manejarVideos(e){
archivosVideos=[...archivosVideos,...e.target.files].slice(0,2);
infoVideos.innerText=archivosVideos.length+" / 2";
galeriaVideos.innerHTML="";
archivosVideos.forEach((v,i)=>{
let d=document.createElement("div");
d.className="foto-item";
d.innerHTML=`<video src="${URL.createObjectURL(v)}" controls></video><button class="btn-borrar-foto" onclick="borrarVideo(${i})">X</button>`;
galeriaVideos.appendChild(d);
});
}

function borrarVideo(i){
archivosVideos.splice(i,1);
manejarVideos({target:{files:[]}})
}

document.getElementById("formInmueble").addEventListener("submit",function(e){
e.preventDefault();
const userActivo=JSON.parse(localStorage.getItem("usuarioSesion"));
if(!userActivo){
alert("‚ùå Debes iniciar sesi√≥n para publicar un anuncio.");
window.location.href="login.html";
return;
}

const nuevoInmueble={
titulo:document.getElementById("titulo").value,
precio:document.getElementById("precio").value,
tipo:document.getElementById("tipoInmueble").value,
tipoAnuncio:document.getElementById("tipoAnuncio").value,
localidad:document.getElementById("localidad").value,
dimensiones:document.getElementById("dimensiones").value,
habitaciones:document.getElementById("tipoInmueble").value==="piso"?document.getElementById("habitaciones").value:"",
banos:document.getElementById("tipoInmueble").value==="piso"?document.getElementById("banos").value:"",
descripcion:document.getElementById("descripcion").value,
fecha:Date.now(),
tieneFotos:archivosFotos.length,
tieneVideos:archivosVideos.length,
duenoEmail:userActivo.email
};

let anuncios=JSON.parse(localStorage.getItem("misAnuncios"))||[];
anuncios.unshift(nuevoInmueble);
localStorage.setItem("misAnuncios",JSON.stringify(anuncios));

alert("üöÄ ¬°Publicado con √©xito!");
window.location.href="purallave.html";
});
</script>

</body>
</html>
